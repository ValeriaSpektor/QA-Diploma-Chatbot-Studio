name: Build and Test

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

env:
  ALLURE_PROJECT_ID: "your-allure-project-id"
  ALLURE_SERVER_URL: "https://allure.your-server.com"
  ALLURE_REPORT_URL: "https://allure.your-server.com/project/your-project-id"

jobs:
  build-and-test:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Build Docker Image
      run: |
        docker build -t playwright-tests .

    - name: Run Tests Inside Docker
      run: |
        docker run --rm \
          -e ALLURE_PROJECT_ID=$ALLURE_PROJECT_ID \
          -e ALLURE_SERVER_URL=$ALLURE_SERVER_URL \
          -e ALLURE_TOKEN=${{ secrets.ALLURE_TOKEN }} \
          -e TELEGRAM_BOT_TOKEN=${{ secrets.TELEGRAM_BOT_TOKEN }} \
          -e TELEGRAM_CHAT_ID=${{ secrets.TELEGRAM_CHAT_ID }} \
          -e ALLURE_REPORT_URL=$ALLURE_REPORT_URL \
          playwright-tests
